package activity;

import java.text.SimpleDateFormat;


import com.hero.app.R;


import android.app.Activity;
import android.app.AlertDialog;
import android.content.DialogInterface;
import android.content.Intent;
import android.graphics.Color;
import android.os.Bundle;
import android.view.View;
import android.view.View.OnClickListener;
import android.view.Menu;
import android.view.MenuItem;
import android.view.Window;
import android.view.WindowManager;
import android.widget.AdapterView;
import android.widget.ArrayAdapter;
import android.widget.Button;
import android.widget.ImageView;
import android.widget.ListView;
import util.ActivityControl;
import util.Fold;
import util.Music;
import android.widget.AdapterView.OnItemClickListener;

public class StartGame extends Activity{

	private ImageView gameImage;
	private Button dialogButton;
	private Button gamestartsetButton;
	private Button saveButton;
	private Button backButton;
	private Button fastButton;
	private Button clearButton;
	
	protected void onCreate(Bundle savedInstanceState) {	
		
		ActivityControl.addActivity(this);
		super.onCreate(savedInstanceState);
        requestWindowFeature(Window.FEATURE_NO_TITLE);
        this.getWindow().setFlags(WindowManager.LayoutParams.FLAG_FULLSCREEN, WindowManager.LayoutParams.FLAG_FULLSCREEN);
        setContentView(R.layout.game);
        
        gameImage = (ImageView)findViewById(R.id.image_game);
        dialogButton = (Button)findViewById(R.id.button_dialog);
        gamestartsetButton = (Button)findViewById(R.id.button_startgameset);
        saveButton = (Button)findViewById(R.id.button_save);
        backButton = (Button)findViewById(R.id.button_backtotitle);
        fastButton = (Button)findViewById(R.id.button_fast);
        clearButton = (Button)findViewById(R.id.button_remove)
      
        //进入该活动时，首先根据i值加载对话内容与背景图片
        dialogButton.setText(Fold.loadScript(StartGame.this, String.valueOf(Main.i)));
        gameImage.setImageResource(R.drawable.game1);
        
 
        
        dialogButton.setOnClickListener(new OnClickListener(){
			@Override
			public void onClick(View arg0) {
				dialogButton.setBackgroundColor(Color.parseColor("#7fDA70D6"));//点击按钮即可抵消清除对话框的效果	
				//点击一次按钮i值加1
				Boolean once = true;
				if(once){
					Main.i = Main.i + 1;
					dialogButton.setText(Fold.loadScript(StartGame.this, String.valueOf(Main.i)));
					once = false;
					}
				}	
			});
        
  
        }
	
	//加载菜单
	public boolean onCreateOptionsMenu(Menu menu)
	{		
		getMenuInflater().inflate(R.menu.main, menu);
		return true;
	}
	
	//设置菜单的点击事件
	public boolean onOptionsItemSelected(MenuItem item)
	{
		switch(item.getItemId()){
		
		//定义菜单的保存存档
		case R.id.menu_save:
			setContentView(R.layout.loadgame);
			//在loadList设置适配器前更改save数组的值
	        Fold.checkSave(StartGame.this);			
			final ArrayAdapter<String> adapter = new ArrayAdapter<String>(StartGame.this, android.R.layout.simple_list_item_1, LoadGame.save);//适配器中储存着存档格式
	       	final ListView loadList = (ListView)findViewById(R.id.listview_loadgame);//列表组件
	       	loadList.setAdapter(adapter);//使用适配器，加载ListView的值
	       	loadList.setOnItemClickListener(new OnItemClickListener(){//定义了ListView的点击子项响应方法

	    	@Override
	    	public void onItemClick(AdapterView<?> parent, View view, int position,long id) 
	    	{	    		
	    		final String str = 	String.format("yyyy-MM-dd hh:mm:ss", new java.util.Date());//将当前时间存储到字符串str中
	    		
	    		if(position == 0)//position是数组中的下标
	    		{   
	    			AlertDialog.Builder dialog = new AlertDialog.Builder(StartGame.this);
	    			dialog.setMessage("进度保存在存档1，确认？");
	    			dialog.setCancelable(false);//只能点击对话框
	    			dialog.setPositiveButton("确认", new DialogInterface.OnClickListener()
	    			{
	    				@Override
	    				public void onClick(DialogInterface dialog, int which)
	    				{
	    					//将当前i值与存档时间保存到相应文件
	    					Fold.save("save0", "存档1           " + str, StartGame.this);
	    					Fold.save("savei0", String.valueOf(Main.i), StartGame.this);
	    					//能够即时显示存档时间
	    					LoadGame.save[0] = "存档1          " + str;
	    	    			loadList.setAdapter(adapter);//重新生成数据 
	    				}
	    			});  
	    			dialog.setNegativeButton("取消",new DialogInterface.OnClickListener()
	    			{
	    				@Override
	    				public void onClick(DialogInterface dialog, int which)
	    				{ 
	    				}
	    			});  
	    			dialog.show();
   			
	    		}
	    		else if(position == 1)
	    		{   
	    			AlertDialog.Builder dialog = new AlertDialog.Builder(StartGame.this);
	    			dialog.setMessage("进度保存在存档2，确认？");
	    			dialog.setCancelable(false);
	    			dialog.setPositiveButton("确认", new DialogInterface.OnClickListener()
	    			{
	    				@Override
	    				public void onClick(DialogInterface dialog, int which)
	    				{
	    					Fold.save("save1", "存档2           " + str, StartGame.this);
	    					Fold.save("savei1", String.valueOf(Main.i), StartGame.this);
	    	    			LoadGame.save[1] = "存档2          " + str;
	    	    			loadList.setAdapter(adapter);//重新生成数据	 
	    				}
	    			});  
	    			dialog.setNegativeButton("取消",new DialogInterface.OnClickListener()
	    			{
	    				@Override
	    				public void onClick(DialogInterface dialog, int which)
	    				{ 
	    				}
	    			});  
	    			dialog.show();		
	    		}
	    		else if(position == 2)//position是数组中的下标
	    		{   
	    			AlertDialog.Builder dialog = new AlertDialog.Builder(StartGame.this);
	    			dialog.setMessage("进度保存在存档3，确认？");
	    			dialog.setCancelable(false);//只能点击对话框
	    			dialog.setPositiveButton("确认", new DialogInterface.OnClickListener()
	    			{
	    				@Override
	    				public void onClick(DialogInterface dialog, int which)
	    				{
	    					Fold.save("save2", "存档3           " + str, StartGame.this);
	    					Fold.save("savei2", String.valueOf(Main.i), StartGame.this);
	    	    			LoadGame.save[2] = "存档3          " + str;
	    	    			loadList.setAdapter(adapter);//重新生成数据
	    				}
	    			});  
	    			dialog.setNegativeButton("取消",new DialogInterface.OnClickListener()
	    			{
	    				@Override
	    				public void onClick(DialogInterface dialog, int which)
	    				{ 
	    				}
	    			});  
	    			dialog.show();
   			
	    		}
	    		else if(position == 3)//position是数组中的下标
	    		{   
	    			AlertDialog.Builder dialog = new AlertDialog.Builder(StartGame.this);
	    			dialog.setMessage("进度保存在存档4，确认？");
	    			dialog.setCancelable(false);//只能点击对话框
	    			dialog.setPositiveButton("确认", new DialogInterface.OnClickListener()
	    			{
	    				@Override
	    				public void onClick(DialogInterface dialog, int which)
	    				{
	    					Fold.save("save3", "存档4           " + str, StartGame.this);
	    					Fold.save("savei3", String.valueOf(Main.i), StartGame.this);
	    	    			LoadGame.save[3] = "存档4          " + str;
	    	    			loadList.setAdapter(adapter);//重新生成数据	 
	    				}
	    			});  
	    			dialog.setNegativeButton("取消",new DialogInterface.OnClickListener()
	    			{
	    				@Override
	    				public void onClick(DialogInterface dialog, int which)
	    				{ 
	    				}
	    			});  
	    			dialog.show();
   			
	    		}
	    		else if(position == 4)//position是数组中的下标
	    		{   
	    			AlertDialog.Builder dialog = new AlertDialog.Builder(StartGame.this);
	    			dialog.setMessage("进度保存在存档5，确认？");
	    			dialog.setCancelable(false);//只能点击对话框
	    			dialog.setPositiveButton("确认", new DialogInterface.OnClickListener()
	    			{
	    				@Override
	    				public void onClick(DialogInterface dialog, int which)
	    				{
	    					Fold.save("save4", "存档5           " + str, StartGame.this);
	    					Fold.save("savei4", String.valueOf(Main.i), StartGame.this);
	    	    			LoadGame.save[4] = "存档5          " + str;
	    	    			loadList.setAdapter(adapter);//重新生成数据 
	    				}
	    			});  
	    			dialog.setNegativeButton("取消",new DialogInterface.OnClickListener()
	    			{
	    				@Override
	    				public void onClick(DialogInterface dialog, int which)
	    				{ 
	    				}
	    			});  
	    			dialog.show();
   			
	    		}
	    		else if(position == 5)//position是数组中的下标
	    		{   
	    			AlertDialog.Builder dialog = new AlertDialog.Builder(StartGame.this);
	    			dialog.setMessage("进度保存在存档6，确认？");
	    			dialog.setCancelable(false);//只能点击对话框
	    			dialog.setPositiveButton("确认", new DialogInterface.OnClickListener()
	    			{
	    				@Override
	    				public void onClick(DialogInterface dialog, int which)
	    				{
	    					Fold.save("save5", "存档6           " + str, StartGame.this);
	    					Fold.save("savei5", String.valueOf(Main.i), StartGame.this);
	    	    			LoadGame.save[5] = "存档6          " + str;
	    	    			loadList.setAdapter(adapter);//重新生成数据 
	    				}
	    			});  
	    			dialog.setNegativeButton("取消",new DialogInterface.OnClickListener()
	    			{
	    				@Override
	    				public void onClick(DialogInterface dialog, int which)
	    				{ 
	    				}
	    			});  
	    			dialog.show();
   			
	    		}
	    }			
    });
	       	Button backtogame = (Button)findViewById(R.id.button_loadgameback);//定义菜单保存存档界面的返回键
	       	backtogame.setOnClickListener(new OnClickListener(){

				@Override
				public void onClick(View arg0) {
					
					Intent intent = new Intent(StartGame.this, StartGame.class);
				    startActivity(intent);
				}    		
	       	});
	       	break;
	       	
	       	
	    //菜单的返回标题界面按钮   	 
		case R.id.menu_back:
			Intent intent = new Intent(StartGame.this, Main.class);
			startActivity(intent);	
			break;
			
			
	    //菜单的退出按钮	
		case R.id.menu_exit:
            Music.stopBackgroundMusic();
			ActivityControl.finishAll();		
			break;
			
		case R.id.menu_fast:
			Main.i = 391;
			Intent intent2 = new Intent(StartGame.this, StartGame.class);
			startActivity(intent2);
			break;
			
			
		//菜单的移除对话框按钮
		case R.id.menu_move:
			final Button dialogButton = (Button)findViewById(R.id.button_dialog);
			dialogButton.setText("");
			dialogButton.setBackgroundColor(Color.parseColor("#00FFFFFF"));//设置按钮的背景颜色
			break;
		}
		
		
		return true;
	}
    @Override
    public void onBackPressed()//对Back键的监听
    { 
    	AlertDialog.Builder dialog = new AlertDialog.Builder(StartGame.this);
		dialog.setMessage("是否要退出游戏");
		dialog.setCancelable(false);//只能点击对话框
		dialog.setPositiveButton("确认", new DialogInterface.OnClickListener()
		{
			@Override
			public void onClick(DialogInterface dialog, int which)
			{
				Music.stopBackgroundMusic();//如果音乐正在播放，停止音乐
				ActivityControl.finishAll();

			}
		});  
		dialog.setNegativeButton("取消",new DialogInterface.OnClickListener()
		{
			@Override
			public void onClick(DialogInterface dialog, int which)
			{ 
			}
		});  
		dialog.show();
		return;		
    }	

}
